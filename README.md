# TrigonometricFunctionTest

各三角関数の実装に於ける処理負荷を計測してみた。その結果及び考察?を備忘録ついでにメモ。  
(現状まだ見えていない所があり、正確な情報とは言い切れないかもしれないのでその点注意。。)

- 三角関数としては以下のもので検証。
  - 三角関数ライブラリ(Mathf.Sin/Cos、math.sin/cos)
  - 三角関数テーブル(sin90度分を確保して使い回し)
  - 自前でマクローリン展開(90度分近くまで近似させたものを一つ用意して使い回し)

- その上で以下の状況で計測を行った。
  - MonoBehaviourのStart内で1000000回sin/cosを実行
  - PureECSでEntityを100000個作成→ComponentSystem内でsin/cosを実行(BurstCompiler有効)

結果としては以下のようになった

----------------------------------------------------------------------------------

- **MonoBehaviourのStart内で1000000回sin/cosを実行**
  - 三角関数ライブラリ : 00:00:00.0915042
  - 三角関数テーブル : 00:00:00.0360298
    - ※sin/cos共に360度分確保→if分岐を無くした状態で計測すると「00:00:00.0072391」
  - マクローリン展開 : 00:00:00.1030873
  
テーブルが一番軽く自前展開が一番重い結果となった。

----------------------------------------------------------------------------------

- **PureECSでEntityを100000個作成→ComponentSystem内でsin/cosを実行**
  - 三角関数ライブラリ : 00:00:00.0001463 ～ 00:00:00.0002651
  - 三角関数テーブル : 00:00:00.0002972 ～ 00:00:00.0003865
  - マクローリン展開 : 00:00:00.0001493 ～ 00:00:00.0002295
  
結果にばらつきがあるので一概には言えないが、三角関数ライブラリと自前展開が大体近い感じの結果となりテーブルの方が一番重くなった。   
この結果については少し気になるところがあり、以前[こちら](https://github.com/mao-test-h/DokabenLogoVR)のプロジェクトにて回転行列の演算を行う際に三角関数ライブラリから三角関数テーブル(後に自前展開に切り替え)で大幅に高速化することが出来たので、これだけみると真逆の結果となっている。
原因としてはキャッシュ効率など色々な点で考えが浮かぶが、明確な答えとなるものは現状見えておらず。。

とりあえずは今回の検証で見ててきた点としては、以前の物では三角関数ライブラリ以外で高速化出来たものの、計測したら違った結果となったので、この対応自体は万能では無いかもしれないという事。

後は別環境/違う計測処理/Unity及びECS等のアップデートでまた結果が変わってくるかもしれないので、何かそれらしきことが見えてきたらまた追記していく予定。
